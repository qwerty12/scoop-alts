{
    "version": "1.64.1b4z",
    "description": "A mangling of uBlock Origin suitable for me to load into ephemeral headless Chromium instances.",
    "homepage": "https://github.com/gorhill/uBlock",
    "license": "GPL-3.0-or-later",
    "url": "https://github.com/gorhill/uBlock/releases/download/1.64.1b4/uBlock0_1.64.1b4.chromium.zip",
    "hash": "0fbbfe869c5f2a7cb8b40d6350b5e7f8e3e02dd3b1553fb9e3e90513467a49b3",
    "post_install": [
        "# https://stackoverflow.com/a/55384556",
        "function Format-Json([Parameter(Mandatory, ValueFromPipeline)][String] $json, [bool] $UseTabs) {",
        "    $indentChar = if ($UseTabs) {\"`t\"} else {'  '}",
        "    $indent = 0;",
        "    ($json -Split '\\r?\\n' | % {",
        "        if ($_ -match '[\\}\\]]\\s*,?\\s*$') { $indent-- }",
        "        $line = ($indentChar * $indent) + $($_.TrimStart() -replace '\":  ([\"{[])', '\": $1' -replace ':  ', ': ')",
        "        if ($_ -match '[\\{\\[]\\s*$') { $indent++ }",
        "        $line",
        "    }) -Join \"`n\"",
        "}",
        "# https://stackoverflow.com/a/47779605",
        "function Convert-UnicodeEscapes([Parameter(Mandatory, ValueFromPipeline)][String] $json) {",
        "    [Regex]::Replace($json, '\\\\u(?<Value>[a-zA-Z0-9]{4})', { param($m) ([char]([int]::Parse($m.Groups['Value'].Value, [System.Globalization.NumberStyles]::HexNumber))).ToString() })",
        "}",
        "$utf8NoBomEncoding = New-Object System.Text.UTF8Encoding($false)",
        "$uboRootDir = Join-Path -Path $original_dir -ChildPath 'uBlock0.chromium'",
        "try {",
        "    $dest = Join-Path -Path $uboRootDir -ChildPath 'js\\background.js'",
        "    $data = Get-Content $dest -Encoding UTF8 -Raw",
        "    $data = $data -replace [regex]::Escape('autoUpdate: true'), 'autoUpdate: false'",
        "    $data = $data -replace [regex]::Escape('const hostnameSwitchesDefault = ['), 'const hostnameSwitchesDefault = [''no-csp-reports: * true'',''no-remote-fonts: * true'','",
        "    [System.IO.File]::WriteAllText($dest, $data, $utf8NoBomEncoding)",
        "} catch {}",
        "try {",
        "    $dest = Join-Path -Path $uboRootDir -ChildPath 'assets\\assets.dev.json'",
        "    $data = ConvertFrom-Json -InputObject (Get-Content $dest -Encoding UTF8 -Raw)",
        "    foreach ($key in @('block-lan', 'fanboy-social', 'fanboy-thirdparty_social')) {",
        "        if ($data.$key -and $data.$key.PSObject.Properties.Name -contains 'off') {",
        "            $data.$key.PSObject.Properties.Remove('off')",
        "        }",
        "    }",
        "    $finalJson = $data | ConvertTo-Json -Depth 100 -Compress:$false | Format-Json -UseTabs:$true | Convert-UnicodeEscapes",
        "    [System.IO.File]::WriteAllText($dest, $finalJson, $utf8NoBomEncoding)",
        "} catch {}"
    ],
    "checkver": {
        "url": "https://api.github.com/repos/gorhill/uBlock/releases?per_page=1",
        "jsonpath": "$[0].tag_name",
        "regex": "([\\w\\.]+)",
        "replace": "${1}z"
    },
    "autoupdate": {
        "url": "https://github.com/gorhill/uBlock/releases/download/$match1/uBlock0_$match1.chromium.zip"
    }
}
